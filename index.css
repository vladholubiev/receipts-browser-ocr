:root {
  --bg: #0f1115;
  --panel: #171a21;
  --text: #e7eaee;
  --muted: #9aa3b2;
  --accent: #4da3ff;
  --bar: #2a2f3a;
  --fill: #4da3ff;
  --ok: #36c690;
  --warn: #ffb74d;
  /* Mobile-first: keep content narrow; large side margins on wide screens */
  --content-max: 640px;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background: var(--bg); color: var(--text);
  overflow-x: hidden; /* prevent stray horizontal scroll */
}
header {
  padding: 12px 16px; background: var(--panel); border-bottom: 1px solid #222634;
  display: flex; align-items: center; gap: 16px; flex-wrap: wrap;
  width: 100%; max-width: var(--content-max);
  margin: 0 auto;
  padding-left: max(16px, env(safe-area-inset-left));
  padding-right: max(16px, env(safe-area-inset-right));
}
header h1 { margin: 0; font-size: 18px; font-weight: 600; }
.controls { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
.controls label { font-size: 12px; color: var(--muted); display: flex; gap: 6px; align-items: center; }
.controls input[type="number"] { width: 72px; }
button { background: var(--accent); color: #04111f; border: none; border-radius: 6px; padding: 8px 12px; font-weight: 600; cursor: pointer; }
button[disabled] { opacity: 0.6; cursor: not-allowed; }

/* Show only failed thumbnails when enabled */
body.fail-only .post .thumb.ok { display: none; }
body.fail-only .post:not(.has-fail) { display: none; }

/* Mobile-first: single column stacked content */
main {
  display: flex; flex-direction: column; gap: 12px;
  min-height: calc(100vh - 58px);
  width: 100%; max-width: var(--content-max);
  margin: 0 auto;
  padding-left: max(16px, env(safe-area-inset-left));
  padding-right: max(16px, env(safe-area-inset-right));
}
section.left { padding: 12px 0; display: flex; flex-direction: column; overflow: visible; border-right: none; }
section.right { padding: 0 0 12px; overflow: visible; }

.step { margin-bottom: 16px; }
.step-header { display: flex; justify-content: space-between; align-items: baseline; font-weight: 600; }
.step .bar { height: 8px; background: var(--bar); border-radius: 999px; overflow: hidden; margin-top: 6px; }
.step .fill { height: 100%; width: 0%; background: var(--fill); transition: width 0.15s ease; }
.step .meta { font-size: 12px; color: var(--muted); margin-top: 6px; min-height: 16px; }
.eta { font-size: 11px; color: var(--muted); }

.totals { margin-top: 24px; border-top: 1px dashed #283044; padding-top: 12px; font-size: 14px; display: flex; flex-direction: column; gap: 6px; flex: 1; min-height: 0; }
.totals .grand { margin-top: 8px; font-size: 18px; font-weight: 700; color: var(--ok); }
.totals .sum-bar { height: 10px; margin-top: 8px; border-radius: 999px; overflow: hidden; background: var(--bar); }
.totals .totals-row { display: flex; flex-direction: column; gap: 10px; margin-top: 10px; flex: 1; min-height: 0; }
.totals .totals-col { display: flex; flex-direction: column; flex: 1; min-height: 0; }
.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; color: #dbe2ee; background: #0a0c10; border: 1px solid #222634; border-radius: 6px; padding: 8px; }
.scroll { width: 100%; }


.logs { margin-top: 14px; }
.logs-header { font-weight: 600; color: var(--muted); margin: 8px 0 6px; }
.log-list { border: 1px solid #222634; background: #0a0c10; border-radius: 6px; padding: 6px; max-height: 160px; overflow: auto; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; overflow-x: hidden; word-break: break-word; overflow-wrap: anywhere; }
.log-line { padding: 2px 4px; }
.log-line.hl { background: rgba(54,198,144,0.25); border-left: 3px solid #36c690; }

.preview-header { display: flex; align-items: center; justify-content: space-between; font-weight: 600; margin-bottom: 8px; }
.feed { display: flex; flex-direction: column; gap: 16px; }
.post { background: #0a0c10; border: 1px solid #222634; border-radius: 8px; padding: 10px; }
.post .meta { font-size: 12px; color: var(--muted); margin-bottom: 8px; }
.post .canvas-wrap { position: relative; background: #0a0c10; border: 1px solid #222634; border-radius: 8px; overflow: hidden; }
.post .thumbs { display: grid; grid-template-columns: 1fr; gap: 8px; margin-top: 8px; }
.post .thumbs .thumb { display: flex; flex-direction: column; gap: 6px; border: 2px solid #222634; border-radius: 8px; padding: 6px; background: #0a0c10; position: relative; }
.post .thumbs .thumb.ok { border-color: #36c690; }
.post .thumbs .thumb.fail { border-color: #ff4d4f; }
.post .thumbs .thumb .label { font-weight: 700; font-size: 12px; color: #e7eaee; }
.post .thumbs .thumb .thumb-canvas-wrap { position: relative; }
.post .thumbs .thumb canvas { width: 100%; background: #0a0c10; border-radius: 6px; display: block; }
.post .thumbs .thumb .line-badge { position: absolute; left: 6px; bottom: 6px; background: #000; border: 1px solid rgba(77, 163, 255, 0.9); color: #cfe3ff; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 11px; padding: 2px 4px; border-radius: 4px; max-width: calc(100% - 12px); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.post .thumbs .thumb .ocr-pre { white-space: pre-wrap; word-break: break-word; overflow-wrap: anywhere; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; color: #dbe2ee; background: #0a0c10; border: 1px solid #222634; border-radius: 6px; padding: 6px; max-height: 220px; overflow: auto; }
.canvas-wrap { position: relative; background: #0a0c10; border: 1px solid #222634; border-radius: 8px; overflow: hidden; }
#pageCanvas, #overlayCanvas { width: 100%; display: block; }
#overlayCanvas { position: absolute; top: 0; left: 0; pointer-events: none; }

.receipts { display: grid; grid-template-columns: 1fr; gap: 8px; }
.receipts canvas { width: 100%; border: 1px solid #222634; border-radius: 6px; background: #0a0c10; }

.ocr-text { grid-column: 1 / -1; background: #0a0c10; border: 1px solid #222634; border-radius: 8px; padding: 8px; white-space: pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; color: #dbe2ee; max-height: 280px; overflow: auto; }

@media (max-width: 1100px) {
  /* Already single-column by default; keep narrower thumbs on small phones */
  .post .thumbs { grid-template-columns: 1fr; }
}

@media (min-width: 520px) {
  /* Allow 2 thumbnails side-by-side on larger phones/tablets */
  .post .thumbs { grid-template-columns: repeat(2, 1fr); }
}
